---
import Layout from "../../layouts/Layout.astro";
import type { GetStaticPaths } from "astro";



export const getStaticPaths: GetStaticPaths = async () => {
    const authorsGlob = await Astro.glob("../../content/authors/*.json");

    const postsGlob = await Astro.glob("../../content/posts/**/*.md");

    const posts = postsGlob.map((post) => post.frontmatter)

    const authors = authorsGlob.map((author) => ({
        author: author.default,
        posts:[],
    }))

    const getPostsByAuthor = (author, posts) => {
        const authorPosts = []
        posts.forEach((post) => {
            // console.log(post.username)
            // console.log(author.author.username)
            if (post.username === author.author.username) {
                authorPosts.push(post)
            }
        })
        return authorPosts;
    }    

    authors.forEach((author) => {
        author.posts = getPostsByAuthor(author, posts)
    })

    return authors.
    map((author) => ({
        params: {username: author.author.username},
        props: {author: author.author, posts: author.posts}
    }))
}


const author = Astro.props.author;
const posts = Astro.props.posts;
console.log(posts)
---
<Layout
    title=`barely there - ${author.default.username}`
current="/blogs"
>


    <h1>
        {author.username}
    </h1>

    <p>
        {author.bio}
    </p>

    <div class="mt-5">
        <ul>
            {posts.map((post) => 
                (
                    <a href={`/blogs/${post.slug}`}>
                        <li>
                            {post.title}
                        </li>
                    </a>
                )
            )}
        </ul>
    </div>



</Layout>